
if [[ $# -eq 1 ]]; then
	MACRO=$1
else
	MACRO=PANIC
fi

echo "Generating code for $MACRO..."

FRAMEWORKDIR=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks
#FRAMEWORKDIR=/System/Library/Frameworks

clang MeClientControl.cpp -o me_client -F${FRAMEWORKDIR} -framework IOKit -D$MACRO

addr=$(nm me_client | grep "fetch_service_port" | cut -d' ' -f1)

addr="0x$addr"

sed -i ".bak" "s/#define ADDR_FETCH_SERVICE_PORT.*/#define ADDR_FETCH_SERVICE_PORT $addr/g" MeClientControl.cpp 

rm MeClientControl.cpp.bak

clang MeClientControl.cpp -o me_client -F${FRAMEWORKDIR} -framework IOKit -D$MACRO



